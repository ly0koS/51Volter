C51 COMPILER V9.59.0.0   FUNC                                                              01/07/2019 17:20:39 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE FUNC
OBJECT MODULE PLACED IN .\Objects\Func.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Func.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Project_Volter) DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\Func.lst) TABS(2) OBJECT(.\Objects\Func.obj)

line level    source

   1          #include "Func.h"
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          
   5          #define key P2
   6          
   7          sbit erflags=PSW^5;
   8          
   9          extern data uchar  param[9];
  10          extern data uint para1,para2;
  11          extern uchar disp[8];
  12          extern uchar d2;
  13          extern uchar k;
  14          
  15          void Calculate()
  16          {
  17   1        uint g,g1,g2;
  18   1        uint freq;
  19   1        if(param[6]==1)
  20   1        {
  21   2          g=10^6/param[1]/32;
  22   2          para1=65536-g;
  23   2          para2=param[2];
  24   2        }
  25   1        if(param[6]==2)
  26   1        {
  27   2          freq=param[3]*1000+param[4];
  28   2          g1=10000/freq*param[5];
  29   2          g2=10000/freq*(100-param[5]);
  30   2          para1=65536-g1;
  31   2          para2=65536-g2;
  32   2        }
  33   1      }
  34          
  35          void ParamProcess()
  36          {
  37   1        uchar freq;
  38   1        if(param[6]==1)
  39   1        {
  40   2          param[1]=disp[6]*10+disp[7];
  41   2        }
  42   1        else if(param[6]==2&&d2==15)
  43   1        {
  44   2          freq=disp[4]*1000+disp[5]*100+disp[6]*10+disp[7];
  45   2          param[7]=freq/256,param[8]=freq%256;
  46   2        }
  47   1        else
  48   1          param[disp[1]*2]=disp[6]*10+disp[7];
  49   1      }
  50          
  51          void NumProcess(unsigned int keynum)
  52          {
  53   1        uchar i;
  54   1        if(k>=4)
C51 COMPILER V9.59.0.0   FUNC                                                              01/07/2019 17:20:39 PAGE 2   

  55   1        {
  56   2          if(param[6]==2&d2==15)                                //Square Wave-Frequence Mode
  57   2          {
  58   3            if(k==4)
  59   3            {
  60   4              if(keynum==1)                                     //Max=1000Hz
  61   4              {
  62   5                disp[k]=keynum;
  63   5                for(i=5;i<8;i++)
  64   5                {
  65   6                  disp[i]=0;
  66   6                }
  67   5              }
  68   4              else if(keynum==0)
  69   4                disp[k]=keynum;
  70   4            }
  71   3            else
  72   3            {
  73   4              if(disp[4]==0)
  74   4              {
  75   5                disp[4]=16;                                       //disp[4] off
  76   5                disp[k]=keynum;
  77   5              }
  78   4            }
  79   3          }
  80   2          else if(k==6)
  81   2          {
  82   3            if(param[6]==2&d2==10)
  83   3            {
  84   4              if(keynum>=2&&keynum<=7)
  85   4                disp[k]=keynum;
  86   4            }
  87   3            else
  88   3            {
  89   4              if(keynum>=1&&keynum<5)                             //Sin Wave-Frequence Mode
  90   4                disp[k]=keynum;
  91   4              else if(keynum==5)                                  //Max=50Hz
  92   4              {
  93   5                disp[k]=keynum;
  94   5                disp[7]=0;
  95   5              }
  96   4            }
  97   3          }
  98   2          else                                                    //maybe else if?
  99   2          {
 100   3            if(param[6]==1&d2==10&&disp[6]==5)                    //Max=50Hz
 101   3            {
 102   4              disp[7]=0;
 103   4            }
 104   3            else
 105   3              disp[k]=keynum;
 106   3          }
 107   2        }
 108   1      }
 109          
 110          void read24c02(void)
 111          {
 112   1        uchar temp,i;
 113   1        sen:  erflags=0;
 114   1          Start();
 115   1          SendByte(0xa0);         
 116   1          cAck( );              
C51 COMPILER V9.59.0.0   FUNC                                                              01/07/2019 17:20:39 PAGE 3   

 117   1          if(erflags==1) goto sen;      
 118   1          SendByte(0x00);           
 119   1          cAck( );              
 120   1          if(erflags==1) goto sen;
 121   1        temp=RcvByte();
 122   1        Ack();
 123   1        if(temp==0x55)
 124   1        {
 125   2          param[0]=0x55;
 126   2          for(i=1;i<8;i++)
 127   2          {
 128   3            Ack();
 129   3            param[i]=RcvByte();
 130   3          }
 131   2          NoAck();
 132   2          Stop();
 133   2        }
 134   1        else
 135   1        {
 136   2          NoAck();
 137   2          Stop();
 138   2          write24c02();
 139   2          Stop();
 140   2        }
 141   1      }
 142          void write24c02(void)
 143          {
 144   1        uchar i;
 145   1        sen:  erflags=0;              
 146   1          Start( );               
 147   1          SendByte(0xa0);         
 148   1          cAck( );              
 149   1          if(erflags==1) goto sen;      
 150   1          SendByte(0x00);           
 151   1          cAck( );              
 152   1          if(erflags==1) goto sen;
 153   1          SendByte(0xa1);
 154   1          cAck();
 155   1        for(i=0;i<8;i++)
 156   1        {
 157   2          SendByte(param[i]);             
 158   2          cAck( );
 159   2        }
 160   1        Stop();
 161   1      }
 162          
 163          int keyscan()
 164          {
 165   1        uchar a,b,temp;
 166   1        key=0xf0;           
 167   1        delay(5);
 168   1        a=P2;
 169   1        P2=0x0f;
 170   1        delay(5);
 171   1        b=P2;
 172   1        a=a|b;
 173   1        if(a!=0xff)
 174   1        {
 175   2          while(P2!=0x0f);
 176   2          switch(a)
 177   2          {
 178   3            case 0xee: temp=0;break;
C51 COMPILER V9.59.0.0   FUNC                                                              01/07/2019 17:20:39 PAGE 4   

 179   3            case 0xde: temp=1;break;
 180   3            case 0xbe: temp=2;break;
 181   3            case 0x7e: temp=3;break;
 182   3            case 0xed: temp=4;break;
 183   3            case 0xdd: temp=5;break;
 184   3            case 0xbd: temp=6;break;
 185   3            case 0x7d: temp=7;break;
 186   3            case 0xeb: temp=110;break;//左移
 187   3            case 0xdb: temp=8;break;
 188   3            case 0xbb: temp=9;break;
 189   3            case 0x7b: temp=120;break;//右移
 190   3            case 0xe7: temp=12;break;//设置键
 191   3            case 0xd7: temp=13;break;//选择波形
 192   3            case 0xb7: temp=14;break;//选择参数
 193   3            case 0x77: temp=15; //确认键
 194   3            }
 195   2        }
 196   1        return temp;
 197   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    802    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
