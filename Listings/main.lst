C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 14:22:00 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Project_Volter) DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2            param[6]=1--->Sin
   3            param[6]=2--->Square Wave
   4          */
   5          
   6          #include "DISP.h"
   7          #include "I2C.h"
   8          #include "Func.h"
   9          #define uchar unsigned char
  10          #define uint unsigned int
  11          
  12          sbit recout=P1^0;
  13          
  14          bit erflags;
  15          bit setup;
  16          bit selectwp;
  17          bit rise;
  18          bit setupend;
  19          
  20          data uchar  param[9]={0x55,50,20,0,50,50,2};
  21          data uchar  p;
  22          data uchar  hide;
  23          data uchar  k;
  24          data uint   para1,para2;
  25          data uchar  da;
  26          data uchar  so;
  27          
  28          extern uchar disp[8];
  29          extern d2;
  30          
  31          int main()
  32          {
  33   1        int keynum;
  34   1        EA=1;
  35   1        ET0=1;
  36   1        ET1=1;
  37   1        PT0=1;
  38   1        PT1=0;
  39   1        TH0=(65536-500)/256;
  40   1        TL0=(65536-500)%256;
  41   1        TR0=1;
  42   1        TR1=1;
  43   1        read24c02();
  44   1        disp[1]=param[6];
  45   1        setup=0;
  46   1        while(1)
  47   1        {
  48   2          keynum=keyscan();
  49   2          if(setup==1)                      //Setup Mode
  50   2          {
  51   3            if(keynum==12)                //setting
  52   3            {
  53   4              setup=0;
  54   4              if(setupend==1)
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 14:22:00 PAGE 2   

  55   4              {
  56   5                setupend=0;
  57   5                write24c02();
  58   5                Calculate();
  59   5              }
  60   4              disp[1]=param[6];
  61   4              display(0,15);
  62   4            }
  63   3            if(keynum==13)                //select wave
  64   3            {
  65   4              if(selectwp==1)
  66   4              {
  67   5                switch(param[6])
  68   5                {
  69   6                  case(1):param[6]=2;break;
  70   6                  case(2):param[6]=1;break;
  71   6                }
  72   5                display(5,15);
  73   5              }
  74   4              else
  75   4              {
  76   5                selectwp=1;
  77   5                k=1;
  78   5                disp[1]=1;
  79   5              }
  80   4              display(5,15);
  81   4            }
  82   3            if(keynum==14)                //select param
  83   3            {
  84   4              k=2;
  85   4              if(selectwp==0)
  86   4              {
  87   5                if(disp[2]!=15)
  88   5                  display(5,15);
  89   5                else
  90   5                  display(5,10);
  91   5              }
  92   4              else
  93   4                selectwp=0;
  94   4            }
  95   3            if(keynum==110)               //go left
  96   3            {
  97   4              if(selectwp==0)
  98   4              {
  99   5                if(disp[2]==15&&disp[1]==2)
 100   5                {
 101   6                  if(k>4)
 102   6                    k--;
 103   6                }
 104   5                else if(k>6)
 105   5                  k--;
 106   5              }
 107   4            }
 108   3            if(keynum==120)               //go right
 109   3            {
 110   4              if(selectwp==0)
 111   4              {
 112   5                if(disp[2]==15&&disp[1]==2)
 113   5                {
 114   6                  if(k<=4)
 115   6                    k=4;
 116   6                  else if(disp[4]==1)
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 14:22:00 PAGE 3   

 117   6                    k=4;
 118   6                }
 119   5                else if(k<=6)
 120   5                  k=6;
 121   5                else if(param[6]==1&&disp[2]==10&&disp[6]==5)
 122   5                  k=6;
 123   5                else
 124   5                  k++;
 125   5              }
 126   4            }
 127   3            if(keynum==15)                //confim
 128   3            {
 129   4              setupend=1;
 130   4              ParamProcess();
 131   4            }
 132   3            else if(keynum<=9&&keynum>=0)
 133   3            {
 134   4              NumProcess(keynum);
 135   4            }
 136   3          }
 137   2          else                            //Not in Setup Mode
 138   2          {
 139   3            if(keynum==12)
 140   3            {
 141   4              setup=1;
 142   4              disp[1]=param[6];
 143   4              display(5,15);
 144   4              selectwp=1; 
 145   4              k=1;
 146   4            }
 147   3            if(keynum==13)
 148   3            {
 149   4              disp[1]=disp[1]+1; 
 150   4              if(disp[1]>=3) 
 151   4                disp[1]=1;
 152   4              display(0,15);
 153   4            }
 154   3            if(keynum==14)
 155   3            {             
 156   4              if(disp[2]!=15) 
 157   4                display(0,15);
 158   4              else    
 159   4                display(0,10);
 160   4            }
 161   3            if(keynum==15)  
 162   3            {
 163   4            if(disp[1]!=param[6])
 164   4              {
 165   5                if(param[6]==1) 
 166   5                  Stop();
 167   5                param[6]=disp[1];
 168   5                EA=0;
 169   5                write24c02();
 170   5                display(0,15);
 171   5                Calculate();
 172   5                EA=1;
 173   5              }
 174   4            }
 175   3          }
 176   2        }
 177   1        return 0;
 178   1      }
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 14:22:00 PAGE 4   

 179          
 180          
 181          void output(void) interrupt 3
 182          {
 183   1        
 184   1        TR1=0;
 185   1        if(param[6]==1)
 186   1        {
 187   2          TH1=para1/256;
 188   2          TL1=para1%256;
 189   2          if(rise)
 190   2          {
 191   3            if(da<240)
 192   3            {
 193   4              da=da+16;
 194   4            }
 195   3            else if(da==240)
 196   3            {
 197   4              da=255;
 198   4              rise=0;
 199   4            }
 200   3          }
 201   2          else
 202   2          {
 203   3            if(da>16)
 204   3            {
 205   4              da=da-16;
 206   4            }
 207   3            else
 208   3            {
 209   4              da=0;
 210   4              rise=1;
 211   4            }
 212   3          }
 213   2          so=para2*da/50;
 214   2          /*Add I2C DAC Code*/
 215   2          sen:  erflags=0;              
 216   2            Start( );               
 217   2            SendByte(0x90);         
 218   2            cAck( );              
 219   2            if(erflags==1) goto sen;      
 220   2            SendByte(0x00);           
 221   2            cAck( );              
 222   2            if(erflags==1) goto sen;
 223   2            SendByte(0x91);
 224   2            cAck(); 
 225   2            if(erflags==1) goto sen;    
 226   2          SendByte(so);
 227   2          cAck();
 228   2        }
 229   1        else if(param[6]==2)
 230   1        {
 231   2          Calculate();
 232   2          recout=~recout;
 233   2          if(recout)  
 234   2          {
 235   3            TH1=para1/256;
 236   3            TL1=para1%256; 
 237   3          }
 238   2          else     
 239   2          {
 240   3            TH1=para2/256;
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 14:22:00 PAGE 5   

 241   3            TL1=para2%256; 
 242   3          }
 243   2        }
 244   1        TR1=1;
 245   1      }
*** WARNING C294 IN LINE 177 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    731    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
