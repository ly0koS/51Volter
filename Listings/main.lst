C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Project_Volter) DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2            param[6]=1--->An Wave
   3            param[6]=2--->Square Wave
   4          */
   5          
   6          #include "DISP.h"
   7          #include "IIC.h"
   8          #include "Func.h"
   9          #define uchar unsigned char
  10          #define uint unsigned int
  11          
  12          sbit recout=P1^0;
  13          sbit OE=P1^3;
  14          sbit duan=P1^4;
  15          sbit wei=P1^5;
  16          sbit K1=P2^0;
  17          sbit K2=P2^1;
  18          
  19          bit erflags;
  20          bit setup;
  21          bit selectwp;
  22          bit rise;
  23          bit setupend;
  24          
  25          data uchar  param[9]={0x55,50,20,0,50,50,2};
  26          data uchar  k;
  27          data uint   para1,para2;
  28          data uchar  da;
  29          data uchar  so;
  30          data uchar  keynum _at_ 0x50;
  31          
  32          extern uchar disp[8],table[];
  33          extern uchar code sled_bit[];
  34          extern uchar d2;
  35          extern uchar hide;
  36          extern unsigned int timing;
  37          extern uchar i;
  38          
  39          int main()
  40          {
  41   1        uchar a,b;
  42   1        EA=1;
  43   1        ET0=1;
  44   1        ET1=1;
  45   1        PT0=1;
  46   1        PT1=0;
  47   1        TH0=(65536-500)/256;
  48   1        TL0=(65536-500)%256;
  49   1        TR0=1;
  50   1        TR1=1;
  51   1        read24c02();
  52   1        Calculate();
  53   1        display(0,15);
  54   1        disp[1]=param[6];
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 2   

  55   1        while(1)
  56   1        {
  57   2          P2=0xf0;
  58   2          delay(5); 
  59   2          a=P2;
  60   2          P2=0x0f;
  61   2          delay(5);
  62   2          b=P2;
  63   2          a=a|b;
  64   2          if(a!=0xff)
  65   2          {
  66   3            while(P2!=0x0f);
  67   3            switch(a)
  68   3            {
  69   4              case 0xee: keynum=0;break;
  70   4              case 0xde: keynum=1;break;
  71   4              case 0xbe: keynum=2;break;
  72   4              case 0x7e: keynum=3;break;
  73   4              case 0xed: keynum=4;break;
  74   4              case 0xdd: keynum=5;break;
  75   4              case 0xbd: keynum=6;break;
  76   4              case 0x7d: keynum=7;break;
  77   4              case 0xeb: keynum=10;break;//左移
  78   4              case 0xdb: keynum=8;break;
  79   4              case 0xbb: keynum=9;break;
  80   4              case 0x7b: keynum=20;break;//右移
  81   4              case 0xe7: keynum=12;break;//设置键
  82   4              case 0xd7: keynum=13;break;//选择波形
  83   4              case 0xb7: keynum=14;break;//选择参数
  84   4              case 0x77: keynum=15; //确认键
  85   4              }
  86   3          }
  87   2          if(setup==1)                      //Setup Mode
  88   2          {
  89   3            if(keynum==12)                //setting
  90   3            {
  91   4              setup=0;
  92   4              if(setupend==1)
  93   4              {
  94   5                setupend=0;
  95   5                write24c02();
  96   5                Calculate();
  97   5                k=99;
  98   5              }
  99   4              disp[1]=param[6];
 100   4              display(0,15);
 101   4            }
 102   3            if(keynum==13)                //select wave
 103   3            {
 104   4              if(selectwp==1)
 105   4              {
 106   5                switch(param[6])
 107   5                {
 108   6                  case(1):param[6]=2;break;
 109   6                  case(2):param[6]=1;break;
 110   6                }
 111   5                display(5,15);
 112   5              }
 113   4              else
 114   4              {
 115   5                selectwp=1;
 116   5                k=1;
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 3   

 117   5                disp[1]=1;
 118   5              }
 119   4              display(5,15);
 120   4            }
 121   3            if(keynum==14)                //select param
 122   3            {
 123   4              k=2;
 124   4              if(selectwp==0)
 125   4              {
 126   5                if(disp[2]!=15)
 127   5                  display(5,15);
 128   5                else
 129   5                  display(5,10);
 130   5              }
 131   4              else
 132   4                selectwp=0;
 133   4            }
 134   3            if(keynum==10)                //go left
 135   3            {
 136   4              if(selectwp==0)
 137   4              {
 138   5                if(disp[2]==15&&disp[1]==2)
 139   5                {
 140   6                  if(k>4)
 141   6                    k--;
 142   6                }
 143   5                else if(k>6)
 144   5                  k--;
 145   5              }
 146   4            }
 147   3            if(keynum==20)                //go right
 148   3            {
 149   4              if(selectwp==0)
 150   4              {
 151   5                if(disp[2]==15&&disp[1]==2)
 152   5                {
 153   6                  if(k<=4)
 154   6                    k=4;
 155   6                  else if(disp[4]==1)
 156   6                    k=4;
 157   6                }
 158   5                else if(k<=6)
 159   5                  k=6;
 160   5                else if(param[6]==1&&disp[2]==10&&disp[6]==5)
 161   5                  k=6;
 162   5                else
 163   5                  k++;
 164   5              }
 165   4            }
 166   3            if(keynum==15)                //confim
 167   3            {
 168   4              setupend=1;
 169   4              ParamProcess();
 170   4            }
 171   3            else if(keynum<=9&&keynum>=0)
 172   3            {
 173   4              NumProcess(keynum);
 174   4            }
 175   3          }
 176   2          else                          //Not in Setup Mode
 177   2          {
 178   3            if(keynum==12)
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 4   

 179   3            {
 180   4              setup=1;
 181   4              disp[1]=param[6];
 182   4              display(5,15);
 183   4              selectwp=1; 
 184   4              k=1;
 185   4            }
 186   3            if(keynum==13)
 187   3            {
 188   4              disp[1]=disp[1]+1; 
 189   4              if(disp[1]>=3) 
 190   4                disp[1]=1;
 191   4              display(0,15);
 192   4            }
 193   3            if(keynum==14)
 194   3            {             
 195   4              if(disp[2]!=15) 
 196   4                display(0,15);
 197   4              else    
 198   4                display(0,10);
 199   4            }
 200   3            if(keynum==15)  
 201   3            {
 202   4            if(disp[1]!=param[6])
 203   4              {
 204   5                if(param[6]==1) 
 205   5                  Stop();
 206   5                param[6]=disp[1];
 207   5                EA=0;
 208   5                write24c02();
 209   5                display(0,15);
 210   5                Calculate();
 211   5                EA=1;
 212   5              }
 213   4            }
 214   3          }
 215   2        }
 216   1        return 0;
 217   1      }
 218          
 219          
 220          void output(void) interrupt 3
 221          {
 222   1        
 223   1        TR1=0;
 224   1        if(param[6]==1)
 225   1        {
 226   2          TH1=para1/256;
 227   2          TL1=para1%256;
 228   2          if(rise)
 229   2          {
 230   3            if(da<240)
 231   3            {
 232   4              da=da+16;
 233   4            }
 234   3            else if(da==240)
 235   3            {
 236   4              da=255;
 237   4              rise=0;
 238   4            }
 239   3          }
 240   2          else
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 5   

 241   2          {
 242   3            if(da>16)
 243   3            {
 244   4              da=da-16;
 245   4            }
 246   3            else
 247   3            {
 248   4              da=0;
 249   4              rise=1;
 250   4            }
 251   3          }
 252   2          so=para2*da/50;
 253   2          /*Add I2C DAC Code*/
 254   2          sen:  erflags=0;              
 255   2            Start( );               
 256   2            SendByte(0x90);         
 257   2            cAck( );              
 258   2            if(erflags==1) goto sen;      
 259   2            SendByte(0x00);           
 260   2            cAck( );              
 261   2            if(erflags==1) goto sen;
 262   2            SendByte(0x91);
 263   2            cAck(); 
 264   2            if(erflags==1) goto sen;
 265   2          SendByte(so);
 266   2          cAck();
 267   2        }
 268   1        else if(param[6]==2)
 269   1        {
 270   2      //    Calculate();
 271   2          recout=~recout;
 272   2          if(recout)  
 273   2          {
 274   3            TH1=para1/256;
 275   3            TL1=para1%256; 
 276   3          }
 277   2          else     
 278   2          {
 279   3            TH1=para2/256;
 280   3            TL1=para2%256; 
 281   3          }
 282   2        }
 283   1        TR1=1;
 284   1      }
 285          
 286          void scan() interrupt 1
 287          {
 288   1        uchar t;
 289   1        TR0=0;
 290   1        TH0=(65536-500)/256;
 291   1        TL0=(65536-500)%256;
 292   1        hide=0xff;
 293   1        if(timing==60)
 294   1        {
 295   2          hide=~hide;
 296   2          timing=0;
 297   2        }
 298   1        t=disp[i];
 299   1        OE=1;
 300   1        if(setup&&(k==i))
 301   1        {
 302   2          P0=table[t]&hide;
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 18:30:11 PAGE 6   

 303   2        }
 304   1        else
 305   1        {
 306   2          P0=table[t];
 307   2        }
 308   1        duan=1;
 309   1        duan=0;
 310   1        P0=sled_bit[i];
 311   1        wei=1;
 312   1        wei=0;
 313   1        OE=0;
 314   1        i++;
 315   1        if(i>=8)
 316   1        {
 317   2          i=0;
 318   2        }
 319   1        timing=timing+1;
 320   1        TR0=1;
 321   1      }
*** WARNING C294 IN LINE 216 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1019    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
