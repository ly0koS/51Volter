C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 23:20:35 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Project_Volter) DEBUG OBJECTEX
                    -TEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2            param[6]=1--->An Wave
   3            param[6]=2--->Square Wave
   4          */
   5          
   6          #include "DISP.h"
   7          #include "IIC.h"
   8          #include "Func.h"
   9          #define uchar unsigned char
  10          #define uint unsigned int
  11          
  12          sbit recout=P1^0;
  13          
  14          
  15          bit erflags;
  16          bit setup;
  17          bit selectwp;
  18          bit rise;
  19          bit setupend;
  20          
  21          data uchar  param[9]={0x55,25,50,0,50,50,1};
  22          data uchar  k;
  23          data uint   para1 _at_ 0x10;
  24          data uint   para2 _at_ 0x11;
  25          data uchar  da;
  26          data uchar  so;
  27          data uint keynum _at_ 0x50;
  28          
  29          extern uchar disp[8];
  30          extern uchar d2;
  31          extern uchar hide;
  32          extern uchar i;
  33          
  34          int main()
  35          {
  36   1        uchar a,b;
  37   1        EA=1;
  38   1        ET0=1;
  39   1        ET1=1;
  40   1        TMOD=0x11;
  41   1        TH0=(65536-500)/256;
  42   1        TL0=(65536-500)%256;
  43   1        TR0=1;
  44   1        TR1=1;
  45   1        read24c02();
  46   1        Calculate();
  47   1        disp[1]=param[6];
  48   1        display(0,15);
  49   1        while(1)
  50   1        {
  51   2          P2=0xf0;
  52   2          delay(5); 
  53   2          a=P2;
  54   2          P2=0x0f;
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 23:20:35 PAGE 2   

  55   2          delay(5);
  56   2          b=P2;
  57   2          a=a|b;
  58   2          if(a!=0xff)
  59   2          {
  60   3            while(P2!=0x0f);
  61   3            switch(a)
  62   3            {
  63   4              case 0xee: keynum=0;break;
  64   4              case 0xde: keynum=1;break;
  65   4              case 0xbe: keynum=2;break;
  66   4              case 0x7e: keynum=3;break;
  67   4              case 0xed: keynum=4;break;
  68   4              case 0xdd: keynum=5;break;
  69   4              case 0xbd: keynum=6;break;
  70   4              case 0x7d: keynum=7;break;
  71   4              case 0xeb: keynum=10;break;//左移
  72   4              case 0xdb: keynum=8;break;
  73   4              case 0xbb: keynum=9;break;
  74   4              case 0x7b: keynum=20;break;//右移
  75   4              case 0xe7: keynum=12;break;//设置键
  76   4              case 0xd7: keynum=13;break;//选择波形
  77   4              case 0xb7: keynum=14;break;//选择参数
  78   4              case 0x77: keynum=15; //确认键
  79   4              }
  80   3          }
  81   2          else
  82   2            keynum=255;
  83   2          if(setup==1)                      //Setup Mode
  84   2          {
  85   3            if(keynum==12)                //setting
  86   3            {
  87   4              setup=0;
  88   4              if(setupend==1)
  89   4              {
  90   5                setupend=0;
  91   5                EA=0;
  92   5                write24c02();
  93   5                Calculate();
  94   5                EA=1;
  95   5                k=255;
  96   5              }
  97   4              disp[1]=param[6];
  98   4              display(0,15);
  99   4              keynum=255;
 100   4            }
 101   3            if(keynum==13)                //select wave
 102   3            {
 103   4              if(selectwp==1)
 104   4              {
 105   5                switch(param[6])
 106   5                {
 107   6                  case(1):disp[1]=2;break;
 108   6                  case(2):disp[1]=1;break;
 109   6                }
 110   5              }
 111   4              else
 112   4              {
 113   5                selectwp=1;
 114   5                k=1;
 115   5                disp[1]=1;
 116   5              }
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 23:20:35 PAGE 3   

 117   4              display(5,15);
 118   4              keynum=255;
 119   4            }
 120   3            if(keynum==14)                //select param
 121   3            {
 122   4              k=2;
 123   4              if(selectwp==0)
 124   4              {
 125   5                if(disp[2]!=15)
 126   5                  display(5,15);
 127   5                else
 128   5                  display(5,10);
 129   5              }
 130   4              else
 131   4                selectwp=0;
 132   4              keynum=255;
 133   4            }
 134   3            if(keynum==10)                //go left
 135   3            {
 136   4              if(selectwp==0)
 137   4              {
 138   5                if(disp[2]==15&&disp[1]==2)
 139   5                {
 140   6                  if(k>4)
 141   6                    k--;
 142   6                }
 143   5                else if(k>6)
 144   5                  k--;
 145   5              }
 146   4              keynum=255;
 147   4            }
 148   3            if(keynum==20)                //go right
 149   3            {
 150   4              if(selectwp==0)
 151   4              {
 152   5                if(k<7)
 153   5                  k++;
 154   5                if((disp[2]==15)&&(disp[1]==2))
 155   5                  {
 156   6                    if((k<4)||(disp[4]==1))
 157   6                      k=4;
 158   6                  }
 159   5                  else 
 160   5                  {
 161   6                    if(k<6)
 162   6                      k=6;
 163   6                    if ((disp[2]!=13)&&(disp[6]==5))
 164   6                      k=6;
 165   6                    if ((disp[2]==13)&&(disp[6]==8))
 166   6                      k=6;
 167   6                  }     
 168   5              }
 169   4              keynum=255;
 170   4            }
 171   3            if(keynum==15)                //confim
 172   3            {
 173   4              setupend=1;
 174   4              ParamProcess();
 175   4              keynum=255;
 176   4            }
 177   3            else if(keynum<=9&&keynum>=0)
 178   3            {
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 23:20:35 PAGE 4   

 179   4              NumProcess(keynum);
 180   4              keynum=255;
 181   4            }
 182   3          }
 183   2          else                          //Not in Setup Mode
 184   2          {
 185   3            k=255;
 186   3            if(keynum==12)
 187   3            {
 188   4              setup=1;
 189   4              disp[1]=param[6];
 190   4              display(5,15);
 191   4              selectwp=1; 
 192   4              k=1;
 193   4              keynum=255;
 194   4            }
 195   3            if(keynum==13)
 196   3            {
 197   4              disp[1]=disp[1]+1; 
 198   4              if(disp[1]>=3) 
 199   4                disp[1]=1;
 200   4              display(0,15);
 201   4              keynum=255;
 202   4            }
 203   3            if(keynum==14)
 204   3            {             
 205   4              if(disp[2]!=15) 
 206   4                display(0,15);
 207   4              else    
 208   4                display(0,10);
 209   4              keynum=255;
 210   4            }
 211   3            if(keynum==15)  
 212   3            {
 213   4              if(disp[1]!=param[6])
 214   4              {
 215   5                if(param[6]==1) 
 216   5                  Stop();
 217   5                param[6]=disp[1];
 218   5                EA=0;
 219   5                write24c02();
 220   5                display(0,15);
 221   5                Calculate();
 222   5                EA=1;
 223   5              }
 224   4              keynum=255;
 225   4            }
 226   3          }
 227   2        }
 228   1        return 0;
 229   1      }
 230          
 231          
 232          void output(void) interrupt 3
 233          {
 234   1        TR1=0;
 235   1        if(param[6]==1)
 236   1        {
 237   2          TH1=para1/256;
 238   2          TL1=para1%256;
 239   2          if(rise) 
 240   2          {   
C51 COMPILER V9.59.0.0   MAIN                                                              01/07/2019 23:20:35 PAGE 5   

 241   3            if(da<=239) da=da+16;
 242   3            else {rise=0; da=255;}
 243   3          }
 244   2          else 
 245   2          {   
 246   3            if(da>=17)  da=da-16;
 247   3            else {rise=1; da=0;}
 248   3          }
 249   2          so=para2*da/50;
 250   2          /*Add I2C DAC Code*/
 251   2          SendByte(so);
 252   2          cAck();
 253   2        }
 254   1        else if(param[6]==2)
 255   1        {
 256   2          recout=~recout;
 257   2          if(recout)  
 258   2          {
 259   3            TH1=para1/256;
 260   3            TL1=para1%256; 
 261   3          }
 262   2          else     
 263   2          {
 264   3            TH1=para2/256;
 265   3            TL1=para2%256; 
 266   3          }
 267   2        }
 268   1        TR1=1;
 269   1      }
 270          
*** WARNING C294 IN LINE 228 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    975    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
